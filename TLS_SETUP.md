# TLS Setup with mkcert

To serve the Picamera2 stream over HTTPS you need a TLS certificate and private key. For
local development and trusted browsers on your network you can generate a locally trusted
certificate by using [`mkcert`](https://github.com/FiloSottile/mkcert).

## 1. Install mkcert

Follow the instructions from the mkcert repository for your operating system. On a recent
Raspberry Pi OS (Debian-based) system this typically looks like:

```bash
sudo apt install libnss3-tools
brew install mkcert # if Homebrew is available, otherwise download from releases
```

If Homebrew is not installed, download the prebuilt binary from the mkcert releases page,
make it executable, and place it somewhere on your `PATH` (for example `/usr/local/bin`).

## 2. Create the local certificate authority

Run mkcert once to create and trust a local certificate authority:

```bash
mkcert -install
```

This step installs a local CA certificate so that browsers and other clients on the same
machine can trust certificates generated by mkcert.

## 3. Generate a certificate for the camera host

Generate a certificate and key pair for the host name or IP address you will use to access
the camera:

```bash
mkcert -cert-file cert.pem -key-file key.pem your-hostname.local 192.168.1.10
```

Replace `your-hostname.local` and `192.168.1.10` with the actual host name and/or IP
address of your Raspberry Pi. You can include multiple names in a single command.

The command creates `cert.pem` and `key.pem` in the current directory. Move these files to
the directory where you run `IPcam.py`.

## 4. Start the HTTPS camera server

Start the camera server and point it to the generated certificate and key:

```bash
python IPcam.py --cert cert.pem --key key.pem --host 0.0.0.0 --port 8443
```

When you access `https://your-hostname.local:8443/` from a browser that trusts the mkcert
CA you should see the MJPEG stream.

## 5. Distributing trust to other devices

Devices that did not run `mkcert -install` will not automatically trust the certificate.
You can export the root CA (`mkcert -CAROOT`) and install it on other devices if needed.
Refer to the mkcert documentation for platform-specific instructions.
